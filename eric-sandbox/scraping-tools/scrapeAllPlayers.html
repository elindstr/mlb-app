<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:,">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
</head>
<body>
    <h2>Export team_id and player_id from API data as list objects</h2>
<button>Go</button>
<div id="team_id"></div>

<div id="player_id"></div>

<div id="pythonList"></div>

<script>

  $("button").on("click", fetchPlayers)
  
  const teamIds = [["D-backs", 109], ["Braves", 144], ["Orioles", 110], ["Red Sox", 111], ["Cubs", 112], ["White Sox", 145], ["Reds", 113], ["Guardians", 114], ["Rockies", 115], ["Tigers", 116], ["Astros", 117], ["Royals", 118], ["Angels", 108], ["Dodgers", 119], ["Marlins", 146], ["Brewers", 158], ["Twins", 142], ["Mets", 121], ["Yankees", 147], ["Athletics", 133], ["Phillies", 143], ["Pirates", 134], ["Padres", 135], ["Giants", 137], ["Mariners", 136], ["Cardinals", 138], ["Rays", 139], ["Rangers", 140], ["Blue Jays", 141], ["Nationals", 120] ]
  let players = []

  async function fetchPlayers() {
    
    
    for (let t = 0; t < teamIds.length; t++) {
        console.log(t+1, "of", teamIds.length)

        let teamId = teamIds[t][1]
        const roster = await getRoster(teamId)
        console.log(roster)

        for (r = 0; r < roster.length; r++) {
            players.push([roster[r].person.fullName, roster[r].person.id, teamIds[t][0]])
        }
        
        await delay(500)
    }

    players.sort((a, b) => a[0].localeCompare(b[0]));

    //   renderTeamList(teams)
    //   $("#team_id").append("<p>")
      //await renderPlayerList(players)
      await renderPythonList(players)
      
  }
  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms))
  }

function renderPlayerList(players) {
    //console.log(players)

    const listDiv = $("#player_id");
    listDiv.empty();
    listDiv.append("player_ids = [");
    for (let i = 0; i < players.length; i++) {
        listDiv.append(`["${players[i][0]}", ${players[i][1]}, "${players[i][2]}"], `);
    }
    listDiv.append("]");
}

function renderPythonList(players) {
    //console.log(players)

    //eg: names = [{"name_first_last": "Austin Adams", "player_id": "613534"},

    const listDiv = $("#pythonList");
    listDiv.empty();
    listDiv.append("names = [");
    for (let i = 0; i < players.length; i++) {
        listDiv.append(`{"name_first_last": "${players[i][0]}", "player_id": "${players[i][1]}"}, `);
    }
    listDiv.append("]");
}

  async function getRoster(team_id) {
      const urlRoster = `http://statsapi.mlb.com/api/v1/teams/${team_id}/roster/`

      try {
          const response = await fetch(urlRoster)
          const data = await response.json()
          console.log(data)
          return data.roster
      } catch (error) {
          console.error("Error fetching roster:", error)
          return []
      }
  }
</script>
<!-- <script src="player_ids_list.js"></script> -->
</body>
</html>
