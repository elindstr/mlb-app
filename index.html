<!-- This is just an internal page for ourselves to demonstrate some useful methods we could use to build an app that looks up the current MLB games by date and provides stats. Obviously a real app should have better UI and separate style.css and .js script files in their conventional directory locations.  -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="data:,"> <!-- killing annoying favicon error -->
    <meta charset="UTF-8" /> <!-- needed to display players names that contain special characters -->
  </head>
<body>

<div id="seasonsDiv">
  <h3>Example method to lookup games by date.</h3>
  <p><i>Uses API: https://statsapi.mlb.com/api/v1/schedule/games/?sportId=1&startDate=${startDate}&endDate=${endDate}</i></p>
  <label for="gamesStartDateSelector">Start Date:</label>
  <input type="date" id="gamesStartDateSelector" />
  <label for="gamesEndDateSelector">End Date:</label>
  <input type="date" id="gamesEndDateSelector" />
  <button id="gamesByDateButton">Go</button>
  <button id="gamesDivClear">Clear</button>
</div>
<div id="gamesDiv"></div>

<hr>

<div id="seasonsDiv">
  <h3>Example method to lookup player by team roster by season.</h3>
  <p><i>Uses API:<ul>
    <li>urlTeams = https://lookup-service-prod.mlb.com/json/named.team_all_season.bam?sport_code='mlb'&all_star_sw='N'&sort_order=name_asc&season='${year}'</li>
    <li>urlRoster = https://lookup-service-prod.mlb.com/json/named.roster_team_alltime.bam?start_season='${season}'&end_season='${seasonEnd}'&team_id='${teamID}'</li>
    <li>urlPlayer = https://lookup-service-prod.mlb.com/json/named.player_info.bam?sport_code='mlb'&player_id='${player_id}'</li></ul>
  Once we have a playerID, we can then look up their performance stats.</i></p>
  <label for="seasonSelector">Enter year of season:</label>
  <input type="text" id="seasonSelector" />
  <button id="seasonButton">Go</button>
  <button id="playerDivClear">Clear</button>
</div>
  <div id="teamsDiv"></div>
  <div id="rosterDiv"></div>
  <div id="playerDiv"></div>

<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<script>

// lookup games by date
$("#gamesByDateButton").on("click", function () {
  let startDate =  $("#gamesStartDateSelector").val()
  let endDate =  $("#gamesEndDateSelector").val()
  let urlGamesByDate = `https://statsapi.mlb.com/api/v1/schedule/games/?sportId=1&startDate=${startDate}&endDate=${endDate}`

  fetch(urlGamesByDate)
  .then(function (response) {
    return response.json()
  })
  .then(function (data) {
    //console.log(data)
    
    // render gamesDiv
    $("#gamesDiv").empty()

    // iterate through result game dates
    for (let d = 0; d < data.dates.length; d++) {
      $("#gamesDiv").append(`<h3>Games on ${data.dates[d].date}</h3>`)
      
      // iterate through games on that day
      for (let g = 0; g < data.dates[d].games.length; g++) {
        let awayTeam = data.dates[d].games[g].teams.away.team.name
        let homeTeam = data.dates[d].games[g].teams.home.team.name
        $("#gamesDiv").append(`<p>${awayTeam} @ ${homeTeam}</p>`)
      }
    }

  })
  .catch(function (error) {
    console.log(error)
  })
})

// clear games div
$("#gamesDivClear").on("click", function () {
  $("#gamesDiv").empty()
})


// lookup teams by year of season
$("#seasonButton").on("click", function () {
  let year = $("#seasonSelector").val()
  urlTeams = `https://lookup-service-prod.mlb.com/json/named.team_all_season.bam?sport_code='mlb'&all_star_sw='N'&sort_order=name_asc&season='${year}'`

  fetch(urlTeams)
  .then(function (response) {
    return response.json()
  })
  .then(function (data) {
    //console.log(data)
    let teamsArray = data.team_all_season.queryResults.row
    if (teamsArray) {
      renderTeams(teamsArray)
    }
  })
  .catch(function (error) {
    console.log(error)
  })
})

// render teams UI
function renderTeams(teamsArray) {
  $("#teamsDiv").empty()
  let label = $("<label>").attr("for", "teamsSelector").text("Select team:")
  let selector = $("<select>").attr("id", "teamsSelector")
  let button = $("<button>").attr("id", "teamsButton").text("Go")
  for (let i = 0; i < teamsArray.length; i++) {
    //console.log(i, teamsArray[i].name)
    selector.append($("<option>")
      .text(teamsArray[i].name)
      .attr("value", teamsArray[i].team_id))
    } 
  $("#teamsDiv").append(label, selector, button)
}

// lookup roster by team
$("#teamsDiv").on("click", "#teamsButton", function () {
  teamID = $("#teamsSelector").val()
  season = $("#seasonSelector").val()
  seasonEnd = parseInt(season) + 1
  urlRoster = `https://lookup-service-prod.mlb.com/json/named.roster_team_alltime.bam?start_season='${season}'&end_season='${seasonEnd}'&team_id='${teamID}'`

  fetch(urlRoster)
  .then(function (response) {
    return response.json()
  })
  .then(function (data) {
    //console.log(data)
    let rosterArray = data.roster_team_alltime.queryResults.row
    if (rosterArray) {
      renderRoster(rosterArray)
    }
  })
  .catch(function (error) {
    console.log(error)
  })
})

// render roster UI
function renderRoster(rosterArray) {
  $("#rosterDiv").empty()
  let label = $("<label>").attr("for", "playerSelector").text("Select player:")
  let selector = $("<select>").attr("id", "playerSelector")
  let button = $("<button>").attr("id", "playerButton").text("Go")
  for (let i = 0; i < rosterArray.length; i++) {
    selector.append($("<option>")
      .text(rosterArray[i].name_sort)
      .attr("value", rosterArray[i].player_id))
    } 
  $("#rosterDiv").append(label, selector, button)
}

// lookup player by roster
$("#rosterDiv").on("click", "#playerButton", function () {
  player_id = $("#playerSelector").val()
  urlPlayer = `https://lookup-service-prod.mlb.com/json/named.player_info.bam?sport_code='mlb'&player_id='${player_id}'`

  fetch(urlPlayer)
  .then(function (response) {
    return response.json()
  })
  .then(function (data) {
    //console.log(data)
    let playerObject = data.player_info.queryResults.row
    if (playerObject) {
      renderPlayer(playerObject)
    }
  })
  .catch(function (error) {
    console.log(error)
  })
})

// render general player stats
function renderPlayer(playerObject) {
  console.log(playerObject)
  $("#playerDiv").empty()
  let table = $("<table>")
  let keys = Object.keys(playerObject)
  for (let i = 0; i < keys.length; i++ ) {
    let tr = $("<tr>")
    let td1 = $(`<td>${keys[i]}</td>`)
    let td2 = $(`<td>${playerObject[keys[i]]}</td>`)
    tr.append(td1, td2)
    table.append(tr)
  }
  $("#playerDiv").append(table)
}
// once we have a player ID, there are lots more specific "Stats Data" we can get

// clear playerDiv
$("#playerDivClear").on("click", function () {
  $("#teamsDiv").empty()
  $("#rosterDiv").empty()
  $("#playerDiv").empty()
})

</script>
</body>
</html>